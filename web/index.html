<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Ma page pour jouer</title>
		<link rel="stylesheet" type="text/css" href="css/chessboard-0.3.0.css">
		<style>
			body{font-family: arial, sans-serif;}
			main {width: 940px; margin:0 auto;}
			button {margin-bottom: 30px;}
		</style>
	</head>
	<body>
		<main>
			<h1>Bienvenue sur Cavachess</h1>
			<button id="jouer">Jouer</button>
			<button id="quitter">Quitter</button>

			<h3 id="adversaire"></h3>
			<section id="jeu">
				<div id="board" style="width: 400px"></div>
				<p>Status: <span id="status"></span></p>
				<p>FEN: <span id="fen"></span></p>
				<p>PGN: <span id="pgn"></span></p>
				<p id="testinfo"></p>			
			</section>	
		</main>
	
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="http://localhost:3000/socket.io/socket.io.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>
		<script src="js/chessboard-0.3.0.js"></script>		
		<script src="js/functions.js"></script>		
				
		<script>
			/* Initialisation */
			var connected = false; // Non connecté
			var username = makeid(); // Utilisateur => à remplacer par une $_SESSION['user']
			var room = ''; // socket room
			var player = ''; // Couleur du joueur

			/* Connexion au serveur */
			// fire un événement 'connection' coté serveur et 'connect' coté client
			var socket = io("http://localhost:3000");

			/* Envoi du pseudo au serveur */
			socket.on('connect', function(data) {
			    connected = true; // Connecté
			    if (username) socket.emit('login', {'username' : username}); // Envoie de l'event 'login' qui contient mon username
			});

			/* Réception de l'initialisation de la partie */
			socket.on('gameStart', function(data) {
			    room = data.room;
			    show_game(data.name, data.room, data.color, 1); // some method which will show game window
			    player = data.color;
			});


			// Voir ligne 95. Inutile dans l'immédiat
			// /* function expression pour quitter le chat (si connecté) */
			// var leave_game = function() { 
			//     if (connected) {
			//         socket.emit('leaveRoom');
			//         //socket.leave(room);
			//         room = '';
			//     }
			// };


			/* Réception event fin de la partie. */
			socket.on('gameEnd', function(data) {
				$('#testinfo').append($('<p>').text("Votre adversaire a quitté !"));
			    //socket.leave(room); // On quitte la room automatiquement (possibilité de le faire coté serveur). Exemple si l'autre user à quitté
			    show_game('rien', 'rien', 'rien', 2);
			    room = ''; 
			});

			/* En cas de déconnexion */
			socket.on('disconnect', function(data) { // handle server/connection falling
			    console.log('Navigateur fermé ou perte de connexion');
			});		




			// if ((game.turn() === 'w' && player === 'black' ) || (game.turn() === 'b' && player === 'white' ))
			// {
			// 	board.position(game.fen());
			// }
			
			$("#jouer").on("click", function() {
				board.position(game.fen());
			});

		</script>
		<script src="js/board.js"></script>
	</body>
</html>